#ifndef UTIL_CONFIGMANAGER_H_
#define UTIL_CONFIGMANAGER_H_

#include <optional>
#include <vector>
#include <string>

#include "nlohmann/json.hpp"
#include "util_export.h"

#include "JsonUtil.h"

namespace ZhKeyes{
    namespace Util{

class Util_API ConfigManager
{
public:
    ConfigManager();

    ~ConfigManager() = default;

    /**
     * @brief ?????????????
     * @param filename ???????，??
     * @return ?????????? true???????? false
     */
    bool load(const std::string& filename);

    /**
     * @brief ???????????????????，??????????
     * @param keys ??，???????????
     *   - ???????{"key"}
     *   - ???，????{"GateServer", "threadNum"}
     * @return ???????????????? std::nullopt
     */
    template<typename T>
    std::optional<T> getSafe(std::initializer_list<std::string> keys) const;

    /**
     * @brief ???????????????????，??????????
     * @param keys ??，?? vector
     * @return ???????????????? std::nullopt
     */
    template<typename T>
    std::optional<T> getSafe(const std::vector<std::string>& keys) const;

    /**
     * @brief ???????，????????
     * @param keys ??，??
     * @return ，????????? true??????? false
     */
    bool hasPath(const std::vector<std::string>& keys) const;

    /**
     * @brief ??????┨???????
     * @param key ????
     * @return ????????? true??????? false
     */
    bool hasKey(const std::string& key) const;

    /**
     * @brief ???????????????
     * @return ???????? true??????? false
     */
    bool isLoaded() const;

private:
    ConfigManager(const ConfigManager&) = delete;
    ConfigManager& operator=(const ConfigManager&) = delete;
    ConfigManager(ConfigManager&&) = delete;
    ConfigManager& operator=(const ConfigManager&&) = delete;

    nlohmann::json  m_json;
    bool m_loaded = false;
};

// ???????????????б?
template<typename T>
std::optional<T> ConfigManager::getSafe(std::initializer_list<std::string> keys) const
{
    return getSafe<T>(std::vector<std::string>(keys));
}

// ?????????? vector
template<typename T>
std::optional<T> ConfigManager::getSafe(const std::vector<std::string>& keys) const
{
    return ZhKeyes::Util::JsonUtil::getSafe<T>(m_json, keys);
}

    }}
#endif //!GATESERVER_CONFIGMANAGER_H_